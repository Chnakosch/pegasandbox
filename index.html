<!DOCTYPE html>
<html>
<body>

<script src='https://c11n-prod-eu-central-1.constellation.cloud.pega.net/c11n/8.8.3-478/pega-embed.js'></script>
<pega-embed id='theEmbed' action='createCase' caseTypeID='Haufe-LeadCapture-Work-WhitepaperDownload' casePage='assignment' deferLoad='true' appAlias='lead-capture' pegaServerUrl='https://chrhfv-hamark-dt1.pegacloud.net/prweb/' staticContentUrl='https://c11n-prod-eu-central-1.constellation.cloud.pega.net/c11n/8.8.3-478/' authService='pega' clientId='49987437234661733137' userIdentifier='myanon' password='UmVrbGFtMjQyNF8=' style='width:100%'></pega-embed>
 
<script>
// Get cookies
let name = "PegaEmail=";
let decodedCookie = decodeURIComponent(document.cookie);
let ca = decodedCookie.split(';');
for(let i = 0; i < ca.length; i++) {
  let c = ca[i];
  while (c.charAt(0) == ' ') {
    c = c.substring(1);
  }
  if (c.indexOf(name == 0) {
      let PegaEmail = c.substring(name.length, c.length);
  }
}
 
// Function to handle the embed ready event
function handleEmbedReady() {
  // Now that the embed is ready, add another listener for the embedprocessingend event
  let elEmbedding = document.getElementById("theEmbed");
  elEmbedding.addEventListener("embedprocessingend", function() {
    // Set cookies
    let PegaEmail = elEmbedding.getEmbedData(".Email");
    let PegaFirstName = elEmbedding.getEmbedData(".Lead.pyFirstName");
    let PegaLastName = elEmbedding.getEmbedData(".Lead.pyLastName");
    let PegaSalutation = elEmbedding.getEmbedData(".Lead.Salutation");
    document.cookie = "PegaEmail=" + PegaEmail;
    document.cookie = "PegaFirstName=" + PegaFirstName;
    document.cookie = "PegaLastName=" + PegaLastName;
    document.cookie = "PegaSalutation=" + PegaSalutation;
    
    // Redirect the user when the embedcloseconfirmview event is triggered
    window.location.href = "https://shop.haufe.de/opt-in";
  });
}
 
// Get the embed element by its ID
let elEmbedding = document.getElementById("theEmbed");

// Set starting fields, load the web embed
elEmbedding.startingFields=`{"Email":"${PegaEmail}"}`;
elEmbedding.load();
 
// Add the listener for the embed ready event
elEmbedding.addEventListener("embedready", handleEmbedReady);
</script>
 
 
</body>
</html>
